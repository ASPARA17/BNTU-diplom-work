<!--<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">-->


<header>
  <img src="../../../../assets/icons/unnamed.jpg" width="70">
  <div class="user">
    <span class="header__name">{{userName['user_second_name']}} {{userName['user_first_name']}}
      {{userName['user_middle_name']}}</span>
    <div ngbDropdown class="d-inline-block">
      <img src="../../../../assets/icons/user.png" width="55" class="btn btn-outline-primary" id="dropdownBasic1" ngbDropdownToggle>
      <div ngbDropdownMenu aria-labelledby="dropdownBasic1">
        <button ngbDropdownItem (click)="logoutUser()">
          Выйти
        </button>
      </div>
    </div>
  </div>
</header>


<div class="wrapper">
  <ul ngbNav #nav="ngbNav" [(activeId)]="active" class="nav-tabs">
    <li [ngbNavItem]="1">
      <a ngbNavLink>Пользователи</a>
      <ng-template ngbNavContent>

<!--        <gui-grid [columns]="columnsUsers"-->
<!--                  [source]="usersList"-->
<!--                  [searching]="searching">-->
<!--        </gui-grid>-->


        <gui-grid [source]="usersList"
                  [searching]="searching"
                  [columnMenu]="columnMenu"
                  [sorting]="sorting">

          <gui-grid-column header="#" width="60">
            <ng-template let-index="index">
              #{{index+1}}
            </ng-template>
          </gui-grid-column>

          <gui-grid-column header="Фамилия" field="user_second_name">
            <ng-template let-value="value">
              {{value}}
            </ng-template>
          </gui-grid-column>

          <gui-grid-column header="Имя" field="user_first_name" >
            <ng-template let-value="value">
              <i>{{value}}</i>
            </ng-template>
          </gui-grid-column>

          <gui-grid-column header="Actions" width="200">
            <ng-template let-item="item">
              <button mat-stroked-button (click)="showDetails(item)">Details</button>
              <button mat-stroked-button (click)="remove(item)">Remove</button>
            </ng-template>
          </gui-grid-column>

        </gui-grid>

        <table class="users table table-striped">
          <thead>
            <tr>
              <th scope="col">Фамилия</th>
              <th scope="col">Имя</th>
              <th scope="col">Отчество</th>
              <th scope="col">Роли</th>
              <th scope="col">Действия</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let user of usersList" class="users__user user">
              <td> {{user.user_second_name}}</td>
              <td> {{user.user_first_name}}</td>
              <td> {{user.user_middle_name}}</td>
              <td>
                <div class="user__role role">
                  <div ngbDropdown class="d-inline-block">
                    <button class="btn btn-outline-primary" id="dropdownBasic1" ngbDropdownToggle>Роли</button>
                    <div ngbDropdownMenu aria-labelledby="dropdownBasic1">
                      <button ngbDropdownItem *ngFor="let role of roles"
                        [ngClass]="{'role__current': role.id === user.role_id}" value={{role.id}}
                        (click)="updateRole(user.user_id,role.name)">
                        <div *ngIf="role.id === user.role_name ; then thenBlock else elseBlock"></div>
                        <ng-template #thenBlock>{{role.name}}</ng-template>
                        <ng-template #elseBlock>{{role.name}}</ng-template>
                      </button>
                    </div>
                  </div>
                </div>
              </td>
              <td>
                <div class="user__actions">
                  <button *ngIf="!user.user_confirm" (click)="confirm(user.user_id)"
                    class="user__confirm btn">Подтвердить</button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </ng-template>
    </li>
    <li [ngbNavItem]="2">
      <a ngbNavLink>Студенты</a>
      <ng-template ngbNavContent>
        <div>
          <label for="institute">Выберите группу</label>
          <ng-select   (change)="filterStudentsByGroupId(groupId)"
                      [(ngModel)]="groupId"
                      [items] = "groupsList"
                      bindLabel="group_name"
                      bindValue="group_id"
                      name="group"
                      placeholder="Группа">
          </ng-select>


<!--          <form class="form-inline">-->
<!--            <input class="form-control mr-sm-2" type="search" placeholder="Поиск" aria-label="Search">-->
<!--            &lt;!&ndash;          <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>&ndash;&gt;-->
<!--            <button type="button" class="add_button btn btn-primary">-->
<!--              <i class="icon-glass"></i>-->
<!--            </button>-->
<!--          </form>-->
          <br>
        </div>

<!--        <div class="input-group">-->
<!--          <div class="form-outline">-->
<!--            <input type="search" id="form1" class="form-control" />-->
<!--            <label class="form-label" for="form1">Поиск</label>-->
<!--          </div>-->
<!--          <button type="button" class="add_button btn btn-primary">-->
<!--            <i class="icon-glass"></i>-->
<!--          </button>-->
<!--        </div>-->
        <div>

        </div>


        <table class="users table table-striped">
          <thead>
            <tr>
              <th scope="col">Группа</th>
              <th scope="col">Специальность</th>
              <th scope="col">Фамилия</th>
              <th scope="col">Имя</th>
              <th scope="col">Отчество</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let student of studentsList" class="users__user user">
              <td> {{student.group_name}}</td>
              <td> {{student.specialty_name}}</td>
              <td> {{student.user_second_name}}</td>
              <td> {{student.user_first_name}}</td>
              <td> {{student.user_middle_name}}</td>
            </tr>
          </tbody>
        </table>
      </ng-template>
    </li>
    <li [ngbNavItem]="3">
      <a ngbNavLink>Специальности</a>
      <ng-template ngbNavContent>
        <div class="addButton">
          <button class="add_button btn btn-primary btn-sm ms-3" (click)="open(addSpecialtyModal)">
            <i class="fa fa-plus"></i>
          </button>
        </div>
        <table class="users table table-striped">
          <thead>
            <tr>
              <th scope="col">Специальность</th>
              <th scope="col">Аббревиатура</th>
              <th scope="col">Код</th>
              <th scope="col">Действия</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let specialty of specialtiesList" class="users__user user">
              <td> {{specialty.specialty_name_full}}</td>
              <td contenteditable='true'> {{specialty.specialty_name}}</td>
              <td> {{specialty.specialty_number}}</td>
              <td>
<!--                <div class="user__actions">-->
<!--                  <button class="button" (click)="openEdit(editModal, specialty)">Редактировать</button>-->
<!--                  <button class="user__delete button" (click)="deleteSpecialty(specialty.specialty_id)">Удалить</button>-->
<!--                </div>-->
                <div>
                  <button class="me-2 btn btn-lg text-dark edit-button">
                    <i class="icon-pencil" (click)="open(addSpecialtyModal1)"></i>
                  </button>
                  <button class="btn btn-lg text-dark delete-button" (click)="deleteSpecialty(specialty.specialty_id)">
                    <i class="icon-trash"></i>
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </ng-template>
    </li>
    <li [ngbNavItem]="4">
      <a ngbNavLink>Группы</a>
      <ng-template ngbNavContent>
        <div class="addButton">
          <button class="add_button btn btn-primary btn-sm ms-3" (click)="open(addGroupModal)">
            <i class="fa fa-plus"></i>
          </button>
        </div>

        <table class="table table-bordered table-responsive-md table-striped text-center" id="example" style="padding: 0.3rem">
          <thead>
            <tr>
              <th scope="col">Специальность</th>
              <th scope="col">Группа</th>
              <th scope="col">Дейсвтия</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let group of groupsList" class="users__user user">
              <td style="padding: 0.3rem"> {{group.specialty_name}}</td>
              <td style="padding: 0.3rem"> {{group.group_name}}</td>
              <td style="padding: 0.3rem">
                <div>
                  <button class="me-2 btn btn-lg text-dark edit-button">
                    <i class="icon-pencil" (click)="open(addGroupModal1)"></i>
                  </button>
                  <button class="btn btn-lg text-dark delete-button" (click)="deleteGroup(group.group_id)">
                    <i class="icon-trash"></i>
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>

      </ng-template>
    </li>
    <li [ngbNavItem]="5">
      <a ngbNavLink>Дипломные руководители</a>
      <ng-template ngbNavContent>
        <table class="users table table-striped">
          <thead>
            <tr>
              <th scope="col">Преподаватель</th>
              <th scope="col">Должность</th>
              <th scope="col">Кол-во мест</th>
              <th scope="col">Занятые места</th>

            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let lector of lectorsList" class="users__user user">
              <td>{{lector.user_second_name}} </td>
              <td>{{lector.position}}</td>
              <td>{{lector.vacancy}}</td>
              <td>{{lector.busy_place}}</td>
            </tr>
          </tbody>
        </table>
      </ng-template>
    </li>
    <li [ngbNavItem]="6">
      <a ngbNavLink>ГЭК</a>
      <ng-template ngbNavContent>
        <table class="users table table-striped">
          <thead>
          <tr>
            <th scope="col">№</th>
            <th scope="col">Дата начала</th>
            <th scope="col">Дата окончания</th>
            <th scope="col">Действия</th>
          </tr>
          </thead>
          <tbody>
          <tr *ngFor="let item of sec; let i = index">
            <td>{{item.sec_number}}</td>
            <td>{{item.sec_start_date}}</td>
            <td>{{item.sec_end_date}}</td>
            <td>
              <div class="user__role role">
                <button class="button" (click)="openEditSec(item.sec_id); getSecCathedra(); getSecSpecialty();
                                  getSecGroup(); getSecPercent();getSecEvent();getSecUsers();">Редактировать</button>
                <button class="user__delete button" (click)="deleteSec(item.sec_id)">Удалить</button>
              </div>
            </td>
          </tr>
          </tbody>
        </table>
        <button class="btn btn-lg btn-outline-primary" (click)="open(content)">Добавить ГЭК</button>
      </ng-template>
    </li>
    <li [ngbNavItem]="7">
      <a ngbNavLink>Темы</a>
      <ng-template ngbNavContent>
        <table class="users table table-striped">
          <thead>
          <tr>
            <th scope="col" style="width:50%">Тема</th>
            <th scope="col">Руководитель</th>
            <th scope="col">Студент</th>
            <th scope="col">Действия</th>
          </tr>
          </thead>
          <tbody>
          <tr *ngFor="let work of allDiplomWorksList" class="users__user user">
            <td> {{work.name}}</td>
            <td> {{work.id_leader}}</td>
            <td> {{work.id_student}}</td>
            <td>
              <div class="user__actions">
                                  <button class="button">Редактировать</button>
                                  <button class="user__delete button">Удалить</button>
                                </div>
            </td>
          </tr>
          </tbody>
        </table>
      </ng-template>
    </li>
    <li [ngbNavItem]="8">
      <a ngbNavLink>Таблица</a>
      <ng-template ngbNavContent>


        <mat-form-field class="example-form-field" appearance="fill">
          <mat-label>Clearable input</mat-label>
          <input matInput type="text" [(ngModel)]="value">
          <button *ngIf="value" matSuffix mat-icon-button aria-label="Clear" (click)="value=''">
            <mat-icon>close</mat-icon>
          </button>
        </mat-form-field>


        <form class="example-form">
          <mat-form-field class="example-full-width" appearance="fill">
            <mat-label>Favorite food</mat-label>
            <input matInput placeholder="Ex. Pizza" value="Sushi">
          </mat-form-field>

        </form>

        <table class="users table table-striped">
          <thead>
          <tr>
            <th scope="col">Фамилия</th>
            <th scope="col">Имя</th>
            <th scope="col">Отчество</th>
            <th scope="col">Роли</th>
            <th scope="col">Действия</th>
          </tr>
          </thead>
          <tbody>
          <tr *ngFor="let user of users" class="users__user user">
            <td> {{user.user_second_name}}</td>
            <td> {{user.user_first_name}}</td>
            <td> {{user.user_middle_name}}</td>
            <td></td>
            <td>
              <div>
                <button class="me-2 btn btn-lg text-dark edit-button">
                  <i class="icon-pencil" (click)="openDialog()"></i>
                </button>
                <button class="btn btn-lg text-dark delete-button">
                  <i class="icon-trash"></i>
                </button>
              </div>
            </td>
          </tr>
          </tbody>
        </table>
      </ng-template>
    </li>
    <li [ngbNavItem]="9">
      <a ngbNavLink>Пример</a>
      <ng-template ngbNavContent>
        <gui-grid #grid
                  id="agile-grid"
                  [theme]="'generic'"
                  [source]="source"
                  [rowColoring]="'none'"
                  [sorting]="sorting"
                  [paging]="false"
                  [columnMenu]="columnMenu"
                  [verticalGrid]="false"
                  [horizontalGrid]="true"
                  [cellEditing]="true"
                  [rowHeight]="70"
                  [rowSelection]="rowSelection"
                  [summaries]="summaries"
                  [loading]="loading"
                  [infoPanel]="false">

          <gui-grid-column header="Name" type="string" width="250"
                           [sorting]="columnSorting" [cellEditing]="false" [matcher]="columnMatcher">
            <ng-template let-value="value" let-index="index" let-item="item">

			<span class="gui-user-wrapper">
				<img src="{{item.avatar}}" class="gui-user-img" />
			</span>

              <div class="gui-user-info" >
                <span class="gui-user-info-name" >{{item.name}}</span>
                <span class="gui-user-info-position" >{{item.position}}</span>
              </div>

            </ng-template>
          </gui-grid-column>

          <gui-grid-column header="Company" [field]="'company'" type="string" view="text"
                           [cellEditing]="true">
          </gui-grid-column>

          <gui-grid-column header="Rating" field="rating" type="number" width="100"
                           [cellEditing]="true">
          </gui-grid-column>

          <gui-grid-column header="Mobile" field="mobile" type="string" view="italic"
                           [enabled]="false"
                           [cellEditing]="false" align="right">
          </gui-grid-column>

          <gui-grid-column header="Status" field="status" type="string" width="160" sorting="false"
                           [cellEditing]="false" >
            <ng-template let-value="value" let-item="item">

              <gui-select [options]="[{value: 'Active'}, {value: 'Inactive'}]"
                          [selected]="{value: value}"
                          [width]="60">
              </gui-select>

            </ng-template>
          </gui-grid-column>

          <gui-grid-column header="Training" field="training" type="number" view="bar" width="140"
                           [summaries]="budgetSummaries"
                           [cellEditing]="true" >
          </gui-grid-column>

          <gui-grid-column header="Budget" field="budget" type="number" width="150"
                           [summaries]="trainingSummaries"
                           [cellEditing]="true" >
            <ng-template let-value="value">

              <ng-container *ngIf="value > 0">
                <div class="gui-align-right gui-budget" style="color: #268e28">$ {{value}}.00</div>
              </ng-container>

              <ng-container *ngIf="value === 0">
                <div class="gui-align-right gui-budget" style="color: #0747a6">$ {{value}}.00</div>
              </ng-container>

              <ng-container *ngIf="value < 0">
                <div class="gui-align-right gui-budget" style="color: #951f1d">$ {{value}}.00</div>
              </ng-container>

            </ng-template>
          </gui-grid-column>

          <gui-grid-column [cellEditing]="false" [sorting]="false" width="60" >
            <ng-template let-value="value" let-item="item">

              <button mat-icon-button [matMenuTriggerFor]="menu">
                <mat-icon>more_vert</mat-icon>
              </button>
              <mat-menu #menu="matMenu">
                <button mat-menu-item (click)="showDetails(item)">
                  <mat-icon>info</mat-icon>
                  <span>Show details</span>
                </button>
                <button mat-menu-item disabled>
                  <mat-icon>edit</mat-icon>
                  <span>Edit</span>
                </button>
                <button mat-menu-item (click)="remove(item.id)">
                  <mat-icon>delete</mat-icon>
                  <span>Remove</span>
                </button>
              </mat-menu>

            </ng-template>
          </gui-grid-column>

        </gui-grid>


      </ng-template>
    </li>
  </ul>
  <div [ngbNavOutlet]="nav"></div>

  <ng-template #addGroupModal let-modal>
    <div class="modal-header">
      <h4 class="modal-title" id="modal-basic-title">Добавление группы</h4>
      <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div class="modal-body">

      <label for="institute">Выберите специальность</label>
      <ng-select
                    [(ngModel)]="specialtyId"
                    [items] = "specialtiesList"
                    bindLabel="specialty_name"
                    bindValue="specialty_id"
                    name="specialty"
                    placeholder="Специальность">
      </ng-select>

      <label>Номер группы</label>
      <input type="text" autocomplete="off" #groupName placeholder="Номер группы" name="groupName">

    </div>
    <div class="modal-footer">
      <button type="button" class="btn btn-outline-dark" (click)="modal.close(); addGroup(groupName.value, specialtyId)">Добавить</button>
    </div>
  </ng-template>

  <ng-template #addGroupModal1 let-modal>
    <div class="modal-header">
      <h4 class="modal-title" id="modal-basic-title">Редактирование группы</h4>
      <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div class="modal-body">

      <label>Специальность</label>
      <input type="text" autocomplete="off" #specialty placeholder="" name="specialty" value="ИСиТ(в проектировании и производстве)">


      <label>Номер группы</label>
      <input type="text" autocomplete="off" #groupName placeholder="Номер группы" name="groupName" value="10702417">

    </div>
    <div class="modal-footer">
      <button type="button" class="btn btn-outline-dark" (click)="modal.close();">Редактировать</button>
    </div>
  </ng-template>

  <ng-template #addSpecialtyModal let-modal>
    <div class="modal-header">
      <h4 class="modal-title" id="modal-basic-title">Добавление специальности</h4>
      <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div class="modal-body">
      <label>Специальность</label>
      <input type="text" autocomplete="off" #fullName placeholder="Специальность" name="fullName">

      <label>Аббревиатура</label>
      <input type="text" autocomplete="off" #name placeholder="Аббревиатура" name="name">

      <label>Код</label>
      <input type="text" autocomplete="off" #number placeholder="Код" name="number">
    </div>
    <div class="modal-footer">
      <button type="button" class="btn btn-primary" (click)="modal.close(); addSpecialty(name.value, fullName.value, number.value)">Добавить</button>
    </div>
  </ng-template>

  <ng-template #addSpecialtyModal1 let-modal>
    <div class="modal-header">
      <h4 class="modal-title" id="modal-basic-title">Редактирование специальности</h4>
      <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div class="modal-body">
      <label>Специальность</label>
      <input type="text" autocomplete="off" #fullName placeholder="Специальность" name="fullName" value="Информационные системы и технологии в проектировании и производстве">

      <label>Аббревиатура</label>
      <input type="text" autocomplete="off" #name placeholder="Аббревиатура" name="name" value="ИСиТ(в проектировании и производстве)">

      <label>Код</label>
      <input type="text" autocomplete="off" #number placeholder="Код" name="number">
    </div>
    <div class="modal-footer">
      <button type="button" class="btn btn-primary" (click)="modal.close();">Редактировать</button>
    </div>
  </ng-template>

  <ng-template #editSpecialtyModal let-modal>
    <div class="modal-header">
      <h4 class="modal-title" id="modal-basic-title">Редактирование специальности</h4>
      <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div class="modal-body">
      <label>Специальность</label>
      <input type="text" autocomplete="off" #fullName placeholder="Специальность" name="fullName" value= >

      <label>Аббревиатура</label>
      <input type="text" autocomplete="off" #name placeholder="Аббревиатура" name="name">

      <label>Код</label>
      <input type="text" autocomplete="off" #number placeholder="Код" name="number">
    </div>
    <div class="modal-footer">
      <button type="button" class="btn btn-primary" (click)="modal.close();
                  editSpecialty(name.value, fullName.value, number.value)">Добавить</button>
    </div>
  </ng-template>

  <ng-template #editModal let-modal>
    <div class="modal-header">
      <h4 class="modal-title" id="modal-basic-title">Редактирование специальности</h4>
      <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div class="modal-body">
      <label>Специальность</label>
      <input type="text" autocomplete="off" #fullName name="fullName" value="{{specialty.specialty_name_full}}">

      <label>Аббревиатура</label>
      <input type="text" autocomplete="off" #name name="name">

      <label>Код</label>
      <input type="text" autocomplete="off" #number name="number">
    </div>
    <div class="modal-footer">
      <button type="button" class="btn btn-primary" (click)="modal.close(); addSpecialty(name.value, fullName.value, number.value)">Добавить</button>
    </div>
  </ng-template>

</div>



